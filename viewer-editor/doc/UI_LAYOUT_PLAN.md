# Plano de UI: Editor GIS com deck.gl

## VisÃ£o Geral

Este documento define a arquitetura de interface do editor GIS, combinando trÃªs paradigmas de UI para mÃ¡xima eficiÃªncia e usabilidade.

## Filosofia de Design

### PrincÃ­pios Fundamentais

1. **Economia de EspaÃ§o Vertical** - Maximizar Ã¡rea do mapa
2. **Contexto PrÃ³ximo Ã  AÃ§Ã£o** - OpÃ§Ãµes aparecem onde o usuÃ¡rio estÃ¡ focado
3. **Progressividade** - Complexidade revelada conforme necessÃ¡rio
4. **ConsistÃªncia** - PadrÃµes previsÃ­veis de interaÃ§Ã£o

### InspiraÃ§Ãµes

| Software | Conceito Adotado |
|----------|------------------|
| **Blender** | Popovers contextuais prÃ³ximos ao Ã­cone |
| **AutoCAD/Ribbon** | OrganizaÃ§Ã£o em abas por categoria |
| **Figma** | PainÃ©is flutuantes para ferramentas dependentes |
| **VS Code** | Barra lateral compacta com Ã­cones |
| **Autodesk Map 3D** | Task Pane com abas para gerenciamento |

---

## Bibliotecas Principais

| Biblioteca | Uso | DocumentaÃ§Ã£o |
|------------|-----|--------------|
| **react-resizable-panels** | Layout redimensionÃ¡vel (Mapa â†” Task Pane â†” Tabela) | [GitHub](https://github.com/bvaughn/react-resizable-panels) |
| **headless-tree** | Ãrvore hierÃ¡rquica de camadas com drag-and-drop | [Docs](https://headless-tree.lukasbach.com/) |
| **deck.gl** | RenderizaÃ§Ã£o de mapas e camadas vetoriais | [deck.gl](https://deck.gl/) |
| **zustand** | Estado global da aplicaÃ§Ã£o | [GitHub](https://github.com/pmndrs/zustand) |
| **lucide-react** | Ãcones consistentes | [Lucide](https://lucide.dev/) |

### react-resizable-panels

Permite criar layouts com painÃ©is redimensionÃ¡veis horizontal e verticalmente.

```tsx
import { Panel, PanelGroup, PanelResizeHandle } from "react-resizable-panels";

// Layout principal da aplicaÃ§Ã£o
<PanelGroup direction="horizontal" autoSaveId="main-layout">
  {/* Ãrea do Mapa */}
  <Panel defaultSize={75} minSize={50}>
    <MapView />
  </Panel>

  <PanelResizeHandle className="w-1 bg-gray-700 hover:bg-primary" />

  {/* Task Pane - colapsÃ¡vel */}
  <Panel
    defaultSize={25}
    minSize={15}
    collapsible
    collapsedSize={4}
    ref={taskPaneRef}
  >
    <TaskPane />
  </Panel>
</PanelGroup>
```

**Features utilizadas:**
- `autoSaveId` - Persiste layout no localStorage automaticamente
- `collapsible` + `collapsedSize` - Task Pane colapsa para Ã­cones (48px)
- `minSize` / `maxSize` - Limites de redimensionamento
- API imperativa: `ref.current.collapse()` / `ref.current.expand()`

### headless-tree

Ãrvore totalmente customizÃ¡vel para gerenciamento de camadas.

```tsx
import { useTree } from "@headless-tree/react";

const tree = useTree<LayerItem>({
  rootItemId: "root",
  getItemName: (item) => item.name,
  isItemFolder: (item) => item.type === "group",
  dataLoader: {
    getItem: (id) => layersMap.get(id),
    getChildren: (id) => getChildLayers(id),
  },
  features: [
    dragAndDropFeature({
      onDrop: (items, target) => reorderLayers(items, target),
    }),
    selectionFeature({
      mode: "multiple",
    }),
    renamingFeature({
      onRename: (item, newName) => renameLayer(item.id, newName),
    }),
    hotkeysCoreFeature(),
    searchFeature(),
  ],
});
```

**Features utilizadas:**
- **Drag-and-drop** - Reordenar camadas arrastando
- **SeleÃ§Ã£o mÃºltipla** - Ctrl+click para selecionar vÃ¡rias
- **Rename inline** - F2 ou duplo-clique para renomear
- **Hotkeys** - Atalhos de teclado customizÃ¡veis
- **Search/Typeahead** - Buscar camadas digitando
- **Async data** - Carregar camadas sob demanda
- **VirtualizaÃ§Ã£o** - Performance com 100k+ itens

---

## Arquitetura de Layout (Modelo com Dois PainÃ©is)

### Filosofia: SeparaÃ§Ã£o de Responsabilidades

| Painel | PosiÃ§Ã£o | Foco | Quando Aparece |
|--------|---------|------|----------------|
| **Selection Panel** | Esquerda | **EdiÃ§Ã£o** - O que estou fazendo | Contextual (quando hÃ¡ seleÃ§Ã£o) |
| **Task Pane** | Direita | **GestÃ£o** - O que existe | Sempre visÃ­vel (colapsÃ¡vel) |

```
Fluxo Cognitivo:
ESQUERDA (AÃ§Ã£o)          CENTRO (VisualizaÃ§Ã£o)       DIREITA (Contexto)
     â”‚                          â”‚                          â”‚
     â”‚    â†â”€â”€ Olho vai â”€â”€â”€â–º     â”‚     â†â”€â”€ Olho vai â”€â”€â”€â–º    â”‚
     â”‚                          â”‚                          â”‚
  "O que estou               "Onde estÃ¡"              "O que existe"
   fazendo"                                           "Como organizar"
```

### Layout Principal

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                                    COMPACT RIBBON (~48px)                                    â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
â”‚  â”‚  ğŸ—ºï¸  â”‚     Desenho     â”‚     SeleÃ§Ã£o     â”‚      Snap       â”‚   Arquivo   â”‚    Ajuda    â”‚ â”‚
â”‚  â”‚ Geo  â”‚  ğŸ“ ğŸ“ â¬¡ â–­ â­•   â”‚  âœ‹ â¬š â­• ğŸ¯    â”‚   ğŸ§² ğŸ“        â”‚  ğŸ“¤ ğŸ“¥ ğŸ—‘ï¸  â”‚    â“ âš™ï¸    â”‚ â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ â–¶ SELEÃ‡ÃƒO       â”‚                                                           â”‚ â—€ TASK PANE   â”‚
â”‚ â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚                                                           â”‚ â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
â”‚ â”‚ 3 objetos   â”‚ â”‚                                                           â”‚ â”‚[ğŸ“‘Camadas]â”‚ â”‚
â”‚ â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤ â”‚                                                           â”‚ â”‚[ğŸ“‹Atribut]â”‚ â”‚
â”‚ â”‚ â–º #42 Pol   â”‚ â”‚                                                           â”‚ â”‚[ğŸ“ŠAnÃ¡lise]â”‚ â”‚
â”‚ â”‚   #43 Pol   â”‚ â”‚                                                           â”‚ â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤ â”‚
â”‚ â”‚   #44 Lin   â”‚ â”‚                                                           â”‚ â”‚           â”‚ â”‚
â”‚ â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤ â”‚                      ÃREA DO MAPA                         â”‚ â”‚ ConteÃºdo  â”‚ â”‚
â”‚ â”‚ DETALHES    â”‚ â”‚                        (deck.gl)                          â”‚ â”‚  da aba   â”‚ â”‚
â”‚ â”‚ Ãrea: 450mÂ² â”‚ â”‚                                                           â”‚ â”‚  ativa    â”‚ â”‚
â”‚ â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤ â”‚                           â¬¡                               â”‚ â”‚           â”‚ â”‚
â”‚ â”‚ EDIÃ‡ÃƒO ğŸ”“   â”‚ â”‚                      (features)                           â”‚ â”‚           â”‚ â”‚
â”‚ â”‚ [âœï¸][â†”ï¸][ğŸ”„]â”‚ â”‚                                                           â”‚ â”‚           â”‚ â”‚
â”‚ â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤ â”‚                                                           â”‚ â”‚           â”‚ â”‚
â”‚ â”‚ OPERAÃ‡Ã•ES   â”‚ â”‚                                                           â”‚ â”‚           â”‚ â”‚
â”‚ â”‚ [âœ‚ï¸][ğŸ”—][â­•]â”‚ â”‚                  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                       â”‚ â”‚           â”‚ â”‚
â”‚ â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤ â”‚                  â”‚ ğŸ“ -49.28,-16.68â”‚                       â”‚ â”‚           â”‚ â”‚
â”‚ â”‚ HISTÃ“RICO   â”‚ â”‚                  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                       â”‚ â”‚           â”‚ â”‚
â”‚ â”‚ â— Criar #42 â”‚ â”‚                                                           â”‚ â”‚           â”‚ â”‚
â”‚ â”‚ â—‹ Mover #43 â”‚ â”‚                                                           â”‚ â”‚           â”‚ â”‚
â”‚ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚                                                           â”‚ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ ğŸ“‹ TABELA: cadastro.lotes (1.234 registros)        [ğŸ” Filtrar...] [âš™ï¸ Colunas] [â¬‡ï¸] [âœ•]   â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚   #   â”‚ inscricao        â”‚ area       â”‚ bairro         â”‚ proprietario                       â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ â–º 42  â”‚ 001.001.042      â”‚ 450.5      â”‚ Centro         â”‚ JoÃ£o Silva                         â”‚
â”‚   43  â”‚ 001.001.043      â”‚ 380.0      â”‚ Centro         â”‚ Maria Santos                       â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ â—€ 1 2 3 ... 50 â–¶  â”‚  Mostrando 1-25 de 1.234  â”‚  Selecionados: 3  â”‚  [CSV] [GeoJSON]       â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ ğŸ“ -49.2800, -16.6800  â”‚  ğŸ” Zoom: 15  â”‚  ğŸ“Š 1.234 features  â”‚  âœï¸ Modo: SeleÃ§Ã£o           â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### Estados do Layout

#### Sem SeleÃ§Ã£o (Mapa Maximizado)

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                              COMPACT RIBBON                                      â”‚
â”œâ”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”¤
â”‚  â”‚                                                                       â”‚ TASK â”‚
â”‚â–¶ â”‚                                                                       â”‚ PANE â”‚
â”‚  â”‚                                                                       â”‚      â”‚
â”‚  â”‚                           MAPA MAXIMIZADO                             â”‚ ğŸ“‘   â”‚
â”‚  â”‚                                                                       â”‚ ğŸ“‹   â”‚
â”‚  â”‚                         (sem seleÃ§Ã£o ativa)                           â”‚ ğŸ“Š   â”‚
â”‚  â”‚                                                                       â”‚      â”‚
â”‚  â”‚                                                                       â”‚      â”‚
â””â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”˜
 â”‚                                                                            â”‚
 â””â”€ Selection Panel colapsado (48px, sÃ³ Ã­cone â–¶)                              â”‚
                                                       Task Pane colapsado (48px)
```

#### Com SeleÃ§Ã£o Ativa (PainÃ©is Expandidos)

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                              COMPACT RIBBON                                      â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ SELECTION   â”‚                                                     â”‚ TASK PANE   â”‚
â”‚ PANEL       â”‚                                                     â”‚             â”‚
â”‚ (280px)     â”‚                      MAPA                           â”‚ (280px)     â”‚
â”‚             â”‚                                                     â”‚             â”‚
â”‚ Lista       â”‚                   â¬¡ â¬¡ â¬¡                            â”‚ Camadas     â”‚
â”‚ Detalhes    â”‚                (selecionados)                       â”‚ Atributos   â”‚
â”‚ EdiÃ§Ã£o      â”‚                                                     â”‚ AnÃ¡lise     â”‚
â”‚ OperaÃ§Ãµes   â”‚                                                     â”‚             â”‚
â”‚ HistÃ³rico   â”‚                                                     â”‚             â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## Selection Panel (Painel Esquerdo)

### Comportamento Contextual

| Estado | Comportamento | Largura |
|--------|---------------|---------|
| **Sem seleÃ§Ã£o** | Colapsado automaticamente | 48px (sÃ³ Ã­cone â–¶) |
| **Com seleÃ§Ã£o** | Expande automaticamente | 280px |
| **Durante desenho** | Mostra info do desenho em progresso | 280px |
| **Manual** | UsuÃ¡rio pode colapsar/expandir manualmente | 48px ou 280px |

### Estrutura Completa do Selection Panel

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ â–¶ SELEÃ‡ÃƒO & EDIÃ‡ÃƒO         [âœ•] â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ OBJETOS SELECIONADOS (4)        â”‚
â”‚ â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
â”‚ â”‚ ğŸ“ cadastro.lotes (3)       â”‚ â”‚  â† Agrupado por camada
â”‚ â”‚ â”œ â–º #42  Polygon   450mÂ²   â”‚ â”‚  â† Selecionado p/ detalhes
â”‚ â”‚ â”œ   #43  Polygon   380mÂ²   â”‚ â”‚
â”‚ â”‚ â””   #44  Polygon   520mÂ²   â”‚ â”‚
â”‚ â”‚â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”‚ â”‚
â”‚ â”‚ ğŸ“ infra.postes (1)         â”‚ â”‚
â”‚ â”‚ â””   #12  Point              â”‚ â”‚
â”‚ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
â”‚                                 â”‚
â”‚ [Todos][Limpar][Inverter][Zoom] â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ DETALHES DO OBJETO (#42)        â”‚
â”‚ â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
â”‚ â”‚ ğŸ”· Polygon    [â—€ 1/4 â–¶]     â”‚ â”‚  â† Navegar entre selecionados
â”‚ â”‚ â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ â”‚ â”‚
â”‚ â”‚ VÃ©rtices: 24                â”‚ â”‚
â”‚ â”‚ Ãrea: 450.5 mÂ²              â”‚ â”‚
â”‚ â”‚ PerÃ­metro: 85.2 m           â”‚ â”‚
â”‚ â”‚ Centroide: -49.28, -16.68   â”‚ â”‚
â”‚ â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤ â”‚
â”‚ â”‚ ATRIBUTOS                   â”‚ â”‚
â”‚ â”‚ inscricao  â”‚ 001.001.042  âœâ”‚ â”‚
â”‚ â”‚ area       â”‚ 450.5        âœâ”‚ â”‚
â”‚ â”‚ bairro     â”‚ Centro       âœâ”‚ â”‚
â”‚ â”‚ [+ Adicionar campo]         â”‚ â”‚
â”‚ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ EDIÃ‡ÃƒO [ğŸ”“ Ativada]             â”‚  â† Status baseado na camada
â”‚ â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
â”‚ â”‚ âœï¸ Editar    â†”ï¸ Mover       â”‚ â”‚
â”‚ â”‚ ğŸ”„ Rotacionar â¤¢ Escalar     â”‚ â”‚
â”‚ â”‚ ğŸ“‹ Duplicar  ğŸ—‘ï¸ Excluir    â”‚ â”‚
â”‚ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
â”‚                                 â”‚
â”‚ âš ï¸ infra.postes estÃ¡ bloqueada â”‚  â† Aviso se camada bloqueada
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ OPERAÃ‡Ã•ES (3 polÃ­gonos)         â”‚
â”‚ â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
â”‚ â”‚ âœ‚ï¸ Cortar      (1 selecion.)â”‚ â”‚  â† SÃ³ com 1 polÃ­gono
â”‚ â”‚ ğŸ”— Unir        (2+ polÃ­gon.)â”‚ â”‚  â† Habilitado
â”‚ â”‚ â– Subtrair    (2 polÃ­gonos)â”‚ â”‚  â† Desabilitado (precisa 2)
â”‚ â”‚ âˆ©  InterseÃ§Ã£o  (2 polÃ­gonos)â”‚ â”‚
â”‚ â”‚ â­• Buffer                   â”‚ â”‚  â† Sempre disponÃ­vel
â”‚ â”‚ ã€°ï¸ Simplificar              â”‚ â”‚
â”‚ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ HISTÃ“RICO DE EDIÃ‡ÃƒO             â”‚
â”‚ â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
â”‚ â”‚ [â†©ï¸ Desfazer] [â†ªï¸ Refazer]  â”‚ â”‚
â”‚ â”‚â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”‚ â”‚
â”‚ â”‚ â— 14:32 Criar polÃ­gono      â”‚ â”‚
â”‚ â”‚   â”” #42 cadastro.lotes      â”‚ â”‚
â”‚ â”‚ â—‹ 14:30 Mover               â”‚ â”‚
â”‚ â”‚   â”” #43 [Reverter]          â”‚ â”‚
â”‚ â”‚ â—‹ 14:28 Editar vÃ©rtice      â”‚ â”‚
â”‚ â”‚   â”” #42 [Reverter]          â”‚ â”‚
â”‚ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
â”‚ â— = atual  â—‹ = anterior         â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### Durante Desenho (Substitui lista de seleÃ§Ã£o)

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ â–¶ DESENHANDO                    â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ ğŸ”· PolÃ­gono                     â”‚
â”‚ â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
â”‚ â”‚ VÃ©rtices: 5                 â”‚ â”‚
â”‚ â”‚ Ãrea: 1.234,56 mÂ²           â”‚ â”‚
â”‚ â”‚ PerÃ­metro: 156,7 m          â”‚ â”‚
â”‚ â”‚â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”‚ â”‚
â”‚ â”‚ Ãšltimo segmento: 45,2 m     â”‚ â”‚
â”‚ â”‚ Ã‚ngulo: 90Â°                 â”‚ â”‚
â”‚ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ ğŸ’¡ DICAS                        â”‚
â”‚ â€¢ Clique para adicionar vÃ©rtice â”‚
â”‚ â€¢ Duplo-clique para finalizar   â”‚
â”‚ â€¢ Backspace remove Ãºltimo       â”‚
â”‚ â€¢ ESC cancela                   â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ OPÃ‡Ã•ES                          â”‚
â”‚ â˜‘ Permitir buracos              â”‚
â”‚ â˜ Auto-interseÃ§Ã£o               â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ [Cancelar]  [Finalizar âœ“]       â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### InteraÃ§Ãµes do Selection Panel

| AÃ§Ã£o | Resultado |
|------|-----------|
| Clique no objeto na lista | Seleciona para detalhes, highlight no mapa |
| Duplo-clique no objeto | Zoom para o objeto |
| Drag na lista | Reordena (para operaÃ§Ãµes ordenadas) |
| â—€ â–¶ nos detalhes | Navega entre objetos selecionados |
| Clique em operaÃ§Ã£o | Executa ou abre painel de configuraÃ§Ã£o |
| Clique em histÃ³rico | Mostra detalhes, opÃ§Ã£o de reverter |

---

## Task Pane (Painel Direito)

### Estados do Task Pane

#### Estado Expandido (280px)

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ â—€ TASK PANE                 â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ [ğŸ“‘ Camadas ][ğŸ“‹ Atributos] â”‚
â”‚ [ğŸ“Š AnÃ¡lise ]               â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                             â”‚
â”‚    ConteÃºdo da aba ativa    â”‚
â”‚    com scroll interno       â”‚
â”‚                             â”‚
â”‚                             â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

#### Estado Colapsado (48px)

```
â”Œâ”€â”€â”€â”€â”
â”‚ â—€  â”‚
â”œâ”€â”€â”€â”€â”¤
â”‚ ğŸ“‘ â”‚
â”‚ ğŸ“‹ â”‚
â”‚ ğŸ“Š â”‚
â””â”€â”€â”€â”€â”˜
```

**Nota:** O HistÃ³rico foi movido para o Selection Panel (esquerda) por ser parte do fluxo de ediÃ§Ã£o.

---

### ConteÃºdo das Abas do Task Pane

#### ğŸ“‘ Aba Camadas (Layer Manager) - usando headless-tree

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ ğŸ“‘ CAMADAS                  â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ ğŸ” Buscar camada...         â”‚  â† searchFeature()
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
â”‚ â”‚ â–¼ ğŸ“ Cadastro           â”‚ â”‚  â† Grupo (folder)
â”‚ â”‚   â”‚                     â”‚ â”‚
â”‚ â”‚   â”‚ ğŸŸ¦ Lotes            â”‚ â”‚  â† Camada
â”‚ â”‚   â”‚ [ğŸ‘ï¸][ğŸ–±ï¸][ğŸ”“][ğŸ”]   â”‚ â”‚  â† Controles inline
â”‚ â”‚   â”‚  â”‚   â”‚   â”‚   â”” Zoom â”‚ â”‚
â”‚ â”‚   â”‚  â”‚   â”‚   â”” EditÃ¡vel â”‚ â”‚
â”‚ â”‚   â”‚  â”‚   â”” SelecionÃ¡vel â”‚ â”‚
â”‚ â”‚   â”‚  â”” VisÃ­vel          â”‚ â”‚
â”‚ â”‚   â”‚ 1.234 features      â”‚ â”‚
â”‚ â”‚   â”‚                     â”‚ â”‚
â”‚ â”‚   â”‚ ğŸŸ© EdificaÃ§Ãµes      â”‚ â”‚
â”‚ â”‚   â”‚ [ğŸ‘ï¸][ğŸ–±ï¸][ğŸ”“][ğŸ”]   â”‚ â”‚
â”‚ â”‚   â”‚ 892 features        â”‚ â”‚
â”‚ â”‚   â”‚                     â”‚ â”‚
â”‚ â”‚   â”‚ ğŸŸ¨ Logradouros      â”‚ â”‚  â† NÃ£o visÃ­vel
â”‚ â”‚   â”‚ [  ][ğŸ–±ï¸][ğŸ”’][ğŸ”]   â”‚ â”‚  â† Bloqueada (ğŸ”’)
â”‚ â”‚   â”‚                     â”‚ â”‚
â”‚ â”‚ â–¶ ğŸ“ Infraestrutura     â”‚ â”‚  â† Grupo colapsado
â”‚ â”‚                         â”‚ â”‚
â”‚ â”‚ â–¼ ğŸ“ Meio Ambiente      â”‚ â”‚
â”‚ â”‚   â”‚ ğŸŸ¢ Ãreas Verdes     â”‚ â”‚
â”‚ â”‚   â”‚ [ğŸ‘ï¸][ğŸ–±ï¸][ğŸ”“][ğŸ”]   â”‚ â”‚
â”‚ â”‚   â”‚ ğŸ”µ Nascentes        â”‚ â”‚
â”‚ â”‚   â”‚ [ğŸ‘ï¸][ğŸ–±ï¸][ğŸ”“][ğŸ”]   â”‚ â”‚
â”‚ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
â”‚                             â”‚
â”‚ â‹® Arraste para reordenar   â”‚  â† dragAndDropFeature()
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ [+ Novo Grupo] [+ Camada]   â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ LEGENDA (camadas visÃ­veis)  â”‚
â”‚ â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
â”‚ â”‚ ğŸŸ¦ â”â” Lotes             â”‚ â”‚
â”‚ â”‚ ğŸŸ© â”â” EdificaÃ§Ãµes       â”‚ â”‚
â”‚ â”‚ ğŸŸ¢ â”â” Ãreas Verdes      â”‚ â”‚
â”‚ â”‚ ğŸ”µ â— Nascentes          â”‚ â”‚
â”‚ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### Controles por Camada

| Ãcone | Estado ON | Estado OFF | DescriÃ§Ã£o |
|-------|-----------|------------|-----------|
| ğŸ‘ï¸ / ğŸ‘ï¸â€ğŸ—¨ï¸ | VisÃ­vel | Oculta | Features renderizadas no mapa |
| ğŸ–±ï¸ / ğŸš« | SelecionÃ¡vel | NÃ£o selecionÃ¡vel | Permite selecionar features |
| ğŸ”“ / ğŸ”’ | EditÃ¡vel | Bloqueada | Permite editar geometrias/atributos |
| ğŸ” | - | - | Zoom para extent da camada |

### Estados de Camada

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  CombinaÃ§Ã£o           â”‚ Comportamento                           â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚  ğŸ‘ï¸ ğŸ–±ï¸ ğŸ”“            â”‚ VisÃ­vel, selecionÃ¡vel e editÃ¡vel       â”‚
â”‚  ğŸ‘ï¸ ğŸ–±ï¸ ğŸ”’            â”‚ VisÃ­vel, selecionÃ¡vel, NÃƒO editÃ¡vel    â”‚
â”‚  ğŸ‘ï¸ ğŸš« ğŸ”’            â”‚ Apenas visualizaÃ§Ã£o (referÃªncia)       â”‚
â”‚     ğŸ–±ï¸ ğŸ”“            â”‚ Oculta mas selecionÃ¡vel (raro)         â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### Menu de Contexto da Camada (botÃ£o direito)

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ ğŸ“‹ Abrir tabela de atributosâ”‚
â”‚ ğŸ” Zoom para camada         â”‚
â”‚ â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ â”‚
â”‚ ğŸ‘ï¸ VisÃ­vel             â˜‘   â”‚
â”‚ ğŸ–±ï¸ SelecionÃ¡vel         â˜‘   â”‚
â”‚ ğŸ”“ EditÃ¡vel             â˜   â”‚
â”‚ â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ â”‚
â”‚ ğŸ¨ Estilo/Simbologia...     â”‚
â”‚ ğŸ“Š EstatÃ­sticas...          â”‚
â”‚ â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ â”‚
â”‚ âœï¸ Renomear                 â”‚
â”‚ ğŸ“‹ Duplicar                 â”‚
â”‚ ğŸ—‘ï¸ Remover                 â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

**InteraÃ§Ãµes (headless-tree):**
- Drag-and-drop para reordenar camadas/grupos
- F2 ou duplo-clique para renomear
- Ctrl+click para seleÃ§Ã£o mÃºltipla de camadas
- Digite para buscar (typeahead)
- Setas â†‘â†“ para navegar, â†â†’ para expandir/colapsar

**Estrutura de dados para headless-tree:**

```typescript
interface LayerItem {
  id: string;
  name: string;
  type: 'group' | 'layer';
  // Controles de estado
  visible: boolean;        // ğŸ‘ï¸ Renderiza no mapa
  selectable: boolean;     // ğŸ–±ï¸ Permite seleÃ§Ã£o de features
  editable: boolean;       // ğŸ”“ Permite ediÃ§Ã£o
  // Visual
  color?: string;
  opacity?: number;
  // Metadados
  featureCount?: number;
  parentId: string | null;
  order: number;
  // Dados da camada
  schema?: string;
  tableName?: string;
  geomColumn?: string;
  geomType?: 'Point' | 'LineString' | 'Polygon' | 'Multi*';
}

// Exemplo de hierarquia
const layers: LayerItem[] = [
  { id: 'cadastro', name: 'Cadastro', type: 'group',
    visible: true, selectable: true, editable: true,
    parentId: null, order: 0 },
  { id: 'lotes', name: 'Lotes', type: 'layer',
    visible: true, selectable: true, editable: true,
    parentId: 'cadastro', order: 0,
    schema: 'cadastro', tableName: 'lotes', featureCount: 1234,
    color: '#3B82F6', geomType: 'Polygon' },
  { id: 'edificacoes', name: 'EdificaÃ§Ãµes', type: 'layer',
    visible: true, selectable: true, editable: false, // SÃ³ visualizaÃ§Ã£o
    parentId: 'cadastro', order: 1 },
  { id: 'logradouros', name: 'Logradouros', type: 'layer',
    visible: false, selectable: true, editable: false, // ReferÃªncia
    parentId: 'cadastro', order: 2 },
];
```

### PropagaÃ§Ã£o de Estado em Grupos

Quando um **grupo** tem seu estado alterado, propaga para todas as camadas filhas:

```
ğŸ“ Cadastro [ğŸ‘ï¸ ON â†’ OFF]
   â”œ Lotes        [ğŸ‘ï¸ OFF]  â† Propagado
   â”œ EdificaÃ§Ãµes  [ğŸ‘ï¸ OFF]  â† Propagado
   â”” Logradouros  [ğŸ‘ï¸ OFF]  â† Propagado (jÃ¡ estava OFF)
```

### Atalhos de Teclado (Camada Selecionada)

| Tecla | AÃ§Ã£o |
|-------|------|
| `V` | Toggle visibilidade |
| `S` | Toggle selecionÃ¡vel |
| `E` | Toggle editÃ¡vel |
| `Z` | Zoom para extent |
| `T` | Abrir tabela de atributos |
| `F2` | Renomear |
| `Delete` | Remover (com confirmaÃ§Ã£o) |

#### ğŸ“‹ Aba Atributos (Attribute Inspector)

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ ğŸ“‹ ATRIBUTOS                â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ FEATURE SELECIONADA         â”‚
â”‚ â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
â”‚ â”‚ #42         [â—€ 1/3 â–¶]   â”‚ â”‚
â”‚ â”‚ â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ â”‚ â”‚
â”‚ â”‚ ğŸ”· Polygon              â”‚ â”‚
â”‚ â”‚ VÃ©rtices: 24            â”‚ â”‚
â”‚ â”‚ Ãrea: 1.234,56 mÂ²       â”‚ â”‚
â”‚ â”‚ PerÃ­metro: 156,7 m      â”‚ â”‚
â”‚ â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤ â”‚
â”‚ â”‚ inscricao  001.001.042 âœâ”‚ â”‚
â”‚ â”‚ area       450.5       âœâ”‚ â”‚
â”‚ â”‚ bairro     Centro      âœâ”‚ â”‚
â”‚ â”‚ proprie... JoÃ£o Silva  âœâ”‚ â”‚
â”‚ â”‚ [+ Adicionar campo]     â”‚ â”‚
â”‚ â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤ â”‚
â”‚ â”‚ [ğŸ”Zoom][ğŸ“‹Copy][ğŸ—‘ï¸Del]â”‚ â”‚
â”‚ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ PREVIEW DA CAMADA           â”‚
â”‚ cadastro.lotes              â”‚
â”‚ â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
â”‚ â”‚  # â”‚ inscricao â”‚ area   â”‚ â”‚
â”‚ â”‚â–º 42â”‚001.001.042â”‚ 450.5  â”‚ â”‚
â”‚ â”‚  43â”‚001.001.043â”‚ 380.0  â”‚ â”‚
â”‚ â”‚  44â”‚001.002.001â”‚ 520.3  â”‚ â”‚
â”‚ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
â”‚ [Abrir tabela completa â†—]   â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

#### ğŸ“Š Aba AnÃ¡lise (Analysis Tools)

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ ğŸ“Š ANÃLISE                  â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ OPERAÃ‡Ã•ES ESPACIAIS         â”‚
â”‚ â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
â”‚ â”‚ â­• Buffer               â”‚ â”‚
â”‚ â”‚    Criar Ã¡rea de        â”‚ â”‚
â”‚ â”‚    influÃªncia           â”‚ â”‚
â”‚ â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤ â”‚
â”‚ â”‚ âœ‚ï¸ Cortar               â”‚ â”‚
â”‚ â”‚    Dividir polÃ­gono     â”‚ â”‚
â”‚ â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤ â”‚
â”‚ â”‚ ğŸ”— Unir                 â”‚ â”‚
â”‚ â”‚    Merge de geometrias  â”‚ â”‚
â”‚ â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤ â”‚
â”‚ â”‚ â– DiferenÃ§a            â”‚ â”‚
â”‚ â”‚    Subtrair geometria   â”‚ â”‚
â”‚ â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤ â”‚
â”‚ â”‚ âˆ© InterseÃ§Ã£o            â”‚ â”‚
â”‚ â”‚    Ãrea em comum        â”‚ â”‚
â”‚ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ MEDIÃ‡ÃƒO                     â”‚
â”‚ â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
â”‚ â”‚ ğŸ“ Medir distÃ¢ncia      â”‚ â”‚
â”‚ â”‚ ğŸ“ Medir Ã¡rea           â”‚ â”‚
â”‚ â”‚ ğŸ“ Medir Ã¢ngulo         â”‚ â”‚
â”‚ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ SELEÃ‡ÃƒO ESPACIAL            â”‚
â”‚ â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
â”‚ â”‚ ğŸ” Por atributo...      â”‚ â”‚
â”‚ â”‚ â¬œ Por retÃ¢ngulo        â”‚ â”‚
â”‚ â”‚ â­• Por raio             â”‚ â”‚
â”‚ â”‚ âœï¸ Por polÃ­gono         â”‚ â”‚
â”‚ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

#### ğŸ“œ Aba HistÃ³rico (History Panel)

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ ğŸ“œ HISTÃ“RICO                â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ [â†©ï¸ Desfazer] [â†ªï¸ Refazer]  â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ OPERAÃ‡Ã•ES RECENTES          â”‚
â”‚ â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
â”‚ â”‚ â— 14:32 Criar polÃ­gono  â”‚ â”‚
â”‚ â”‚   â”” cadastro.lotes #42  â”‚ â”‚
â”‚ â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤ â”‚
â”‚ â”‚ â—‹ 14:30 Editar atributo â”‚ â”‚
â”‚ â”‚   â”” bairro: Centro      â”‚ â”‚
â”‚ â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤ â”‚
â”‚ â”‚ â—‹ 14:28 Mover vÃ©rtice   â”‚ â”‚
â”‚ â”‚   â”” cadastro.lotes #41  â”‚ â”‚
â”‚ â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤ â”‚
â”‚ â”‚ â—‹ 14:25 Buffer 100m     â”‚ â”‚
â”‚ â”‚   â”” infra.postes        â”‚ â”‚
â”‚ â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤ â”‚
â”‚ â”‚ â—‹ 14:20 Importar GeoJSONâ”‚ â”‚
â”‚ â”‚   â”” 45 features         â”‚ â”‚
â”‚ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ â— = Estado atual            â”‚
â”‚ â—‹ = OperaÃ§Ã£o anterior       â”‚
â”‚ Clique para reverter        â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

### PainÃ©is de OperaÃ§Ã£o (Flutuantes)

Aparecem **apenas** durante operaÃ§Ãµes ativas, posicionados no canto superior esquerdo.

#### Durante Desenho

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ ğŸ”· Desenhando PolÃ­gono  â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ VÃ©rtices: 5             â”‚
â”‚ Ãrea: 1.234 mÂ²          â”‚
â”‚ PerÃ­metro: 156 m        â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ ğŸ’¡ Dicas:               â”‚
â”‚ â€¢ Clique para adicionar â”‚
â”‚ â€¢ Duplo-clique p/ fecharâ”‚
â”‚ â€¢ Backspace remove      â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ [Cancelar] [Finalizar]  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

#### Durante Buffer

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ â­• Buffer               â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ Camada: cadastro.lotes  â”‚
â”‚ Features: 3 selecionadasâ”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ DistÃ¢ncia:              â”‚
â”‚ [====â—‹====] 100 m       â”‚
â”‚                         â”‚
â”‚ â˜ Dissolver buffers     â”‚
â”‚ â˜ Apenas interno        â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ Preview: ğŸ”µ (no mapa)   â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ [Cancelar] [Aplicar]    â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

#### Durante Corte

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ âœ‚ï¸ Cortar PolÃ­gono      â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ Feature: #42            â”‚
â”‚ Status: Aguardando linhaâ”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ ğŸ’¡ Desenhe uma linha    â”‚
â”‚    atravessando o       â”‚
â”‚    polÃ­gono para cortÃ¡-loâ”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ Linha: 2 pontos         â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ [Cancelar] [Cortar]     â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

### Layout Responsivo

#### Desktop (>1200px)
```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                      MAPA                             â”‚ TASK PANE  â”‚
â”‚                                                       â”‚ (280px)    â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                    TABELA DE ATRIBUTOS                             â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

#### Tablet (900-1200px)
```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”
â”‚                      MAPA                             â”‚ TASK â”‚
â”‚                                                       â”‚(48px)â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”¤
â”‚                    TABELA (altura reduzida)                  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

#### Mobile (<900px)
```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚              MAPA                   â”‚
â”‚                                     â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ [ğŸ“‘][ğŸ“‹][ğŸ“Š][ğŸ“œ]  â† Bottom tabs    â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚     ConteÃºdo da aba (sheet)         â”‚
â”‚     (arrasta para expandir)         â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

### InteraÃ§Ãµes entre Componentes

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                                                                  â”‚
â”‚   TASK PANE                    MAPA                   TABELA    â”‚
â”‚   â”€â”€â”€â”€â”€â”€â”€â”€â”€                    â”€â”€â”€â”€                   â”€â”€â”€â”€â”€â”€    â”‚
â”‚                                                                  â”‚
â”‚   Clica camada â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–º Zoom para extent                 â”‚
â”‚        â”‚                                                        â”‚
â”‚        â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–º Abre     â”‚
â”‚                                                                  â”‚
â”‚   Clica feature â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–º Highlight            â–º Scroll    â”‚
â”‚                                                                  â”‚
â”‚                               Clica feature â”€â”€â”€â”€â”€â”€â”€â–º Scroll     â”‚
â”‚                                    â”‚                             â”‚
â”‚   Atualiza â—„â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                             â”‚
â”‚                                                                  â”‚
â”‚                                                    Clica linha  â”‚
â”‚   Atualiza â—„â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ Highlight â—„â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜        â”‚
â”‚                                                                  â”‚
â”‚   AnÃ¡lise â”€â”€â”€â–º Painel Op â”€â”€â”€â”€â–º Preview no mapa                  â”‚
â”‚                    â”‚                                             â”‚
â”‚                    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â–º Resultado â”€â”€â”€â”€â”€â”€â”€â”€â”€â–º Atualiza    â”‚
â”‚                                                                  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## ClassificaÃ§Ã£o de Ferramentas

### Regra de Ouro

> **AtivaÃ§Ã£o/ConfiguraÃ§Ã£o** â†’ Popover no Ribbon
> **Dependente de Contexto** â†’ Painel Flutuante no Mapa

### Tabela de ClassificaÃ§Ã£o

| Ferramenta | Tipo | LocalizaÃ§Ã£o | CondiÃ§Ã£o de ExibiÃ§Ã£o |
|------------|------|-------------|----------------------|
| **Snap On/Off** | AtivaÃ§Ã£o | Popover Ribbon | Sempre disponÃ­vel |
| **Modo de Snap** | ConfiguraÃ§Ã£o | Popover Ribbon | Sempre disponÃ­vel |
| **DistÃ¢ncia de Snap** | ConfiguraÃ§Ã£o | Popover Ribbon | Sempre disponÃ­vel |
| **Guias de Snap** | AtivaÃ§Ã£o | Popover Ribbon | Sempre disponÃ­vel |
| **Cortar PolÃ­gono** | Dependente | Flutuante Mapa | PolÃ­gono selecionado |
| **Unir PolÃ­gonos** | Dependente | Flutuante Mapa | 2+ polÃ­gonos selecionados |
| **Subtrair** | Dependente | Flutuante Mapa | 2 polÃ­gonos selecionados |
| **InterseÃ§Ã£o** | Dependente | Flutuante Mapa | 2 polÃ­gonos selecionados |
| **Buffer** | Dependente | Flutuante Mapa | Feature selecionada |
| **Simplificar** | Dependente | Flutuante Mapa | Linha/PolÃ­gono selecionado |
| **Estender Linha** | Dependente | Flutuante Mapa | Linha selecionada |
| **Permitir Buracos** | ConfiguraÃ§Ã£o | Popover Ribbon | Modo polÃ­gono ativo |
| **Auto-interseÃ§Ã£o** | ConfiguraÃ§Ã£o | Popover Ribbon | Modo desenho ativo |

---

## Componentes de UI

### 1. Compact Ribbon (Topo)

Altura fixa de **48px**, sempre visÃ­vel.

#### Estrutura

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  [Logo] â”‚ [Tab1] [Tab2] [Tab3] [Tab4] â”‚ [AÃ§Ãµes Globais]        â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚  [Ãcones da aba ativa com popovers]                             â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

#### Abas do Ribbon

| Aba | Ãcone | Ferramentas |
|-----|-------|-------------|
| **InÃ­cio** | ğŸ  | Novo, Abrir, Salvar, Exportar |
| **Desenho** | âœï¸ | Ponto, Linha, PolÃ­gono, RetÃ¢ngulo, CÃ­rculo, Elipse |
| **EdiÃ§Ã£o** | ğŸ”§ | Selecionar, Modificar, Mover, Rotacionar, Escalar |
| **Snap** | ğŸ§² | Toggle Snap, Modo, DistÃ¢ncia, Guias, ReferÃªncias |
| **HistÃ³rico** | ğŸ“œ | Lista de operaÃ§Ãµes, Reverter, Reaplicar |
| **Camadas** | ğŸ“‘ | Gerenciar camadas, Visibilidade |

#### Comportamento dos Popovers

```typescript
interface PopoverConfig {
  trigger: 'click' | 'hover';      // Click para configuraÃ§Ãµes
  position: 'bottom' | 'bottom-start' | 'bottom-end';
  closeOnClickOutside: true;
  closeOnEscape: true;
  maxHeight: '300px';              // Scroll se necessÃ¡rio
}
```

### 2. PainÃ©is Flutuantes (Sobre o Mapa)

Aparecem **dinamicamente** baseados no contexto atual.

#### Posicionamento

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                                                         â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”‚
â”‚  â”‚ POSIÃ‡ÃƒO 1   â”‚                    â”‚ POSIÃ‡ÃƒO 2   â”‚    â”‚
â”‚  â”‚ (esquerda)  â”‚                    â”‚ (direita)   â”‚    â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â”‚
â”‚                                                         â”‚
â”‚                       MAPA                              â”‚
â”‚                                                         â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”‚
â”‚  â”‚ POSIÃ‡ÃƒO 3   â”‚                    â”‚ POSIÃ‡ÃƒO 4   â”‚    â”‚
â”‚  â”‚ (esq-baixo) â”‚                    â”‚ (dir-baixo) â”‚    â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â”‚
â”‚                                                         â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

#### Tipos de PainÃ©is Flutuantes

| Painel | PosiÃ§Ã£o | CondiÃ§Ã£o |
|--------|---------|----------|
| **OperaÃ§Ãµes de PolÃ­gono** | Esquerda (1) | PolÃ­gono(s) selecionado(s) |
| **OperaÃ§Ãµes de Linha** | Esquerda (1) | Linha(s) selecionada(s) |
| **Propriedades RÃ¡pidas** | Direita (2) | Qualquer feature selecionada |
| **OpÃ§Ãµes de Desenho** | Esquerda-baixo (3) | Modo de desenho ativo |
| **MediÃ§Ã£o** | Direita-baixo (4) | Modo mediÃ§Ã£o ativo |

#### Estrutura do Painel

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ TÃ­tulo            [x]  â”‚  â† Header com botÃ£o fechar
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                        â”‚
â”‚  [ConteÃºdo do Painel]  â”‚  â† BotÃµes, inputs, toggles
â”‚                        â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### 3. Status Bar (RodapÃ©)

Altura fixa de **24px**, informaÃ§Ãµes do contexto atual.

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ ğŸ“ -49.2800, -16.6800 â”‚ ğŸ” Zoom: 15 â”‚ ğŸ“Š 42 features â”‚ âœï¸ Desenho â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### 4. Tabela de Atributos (Painel Inferior)

Painel retrÃ¡til na parte inferior que mostra todos os registros de uma camada (estilo QGIS).

#### Layout

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ RIBBON                                                                   â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                          â”‚
â”‚                              MAPA                                        â”‚
â”‚                                                                          â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ ğŸ“‹ Tabela: cadastro.lotes (1.234 registros)  [ğŸ” Filtrar] [â¬‡ï¸] [âœ•]      â”‚
â”œâ”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚  #   â”‚ inscricao      â”‚ area     â”‚ bairro       â”‚ proprietario          â”‚
â”œâ”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ â–º 1  â”‚ 001.001.001    â”‚ 450.5    â”‚ Centro       â”‚ JoÃ£o Silva            â”‚
â”‚   2  â”‚ 001.001.002    â”‚ 380.0    â”‚ Centro       â”‚ Maria Santos          â”‚
â”‚   3  â”‚ 001.002.001    â”‚ 520.3    â”‚ Jardim       â”‚ Pedro Oliveira        â”‚
â”œâ”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ PÃ¡gina 1 de 50  â”‚ â—€ â–¶ â”‚ Mostrando 1-25 de 1.234  â”‚ Selecionados: 1     â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

#### Funcionalidades da Tabela

| Funcionalidade | DescriÃ§Ã£o |
|----------------|-----------|
| **Abrir tabela** | Clique direito na camada â†’ "Abrir tabela de atributos" |
| **PaginaÃ§Ã£o** | 25/50/100 registros por pÃ¡gina (camadas podem ter milhares) |
| **SeleÃ§Ã£o** | Clique na linha seleciona no mapa, Ctrl+clique para mÃºltiplos |
| **Zoom** | Duplo-clique na linha faz zoom para a feature |
| **OrdenaÃ§Ã£o** | Clique no cabeÃ§alho ordena ASC/DESC |
| **Filtro** | Campo de busca filtra em todas as colunas |
| **Filtro SQL** | ExpressÃ£o SQL para filtros avanÃ§ados |
| **EdiÃ§Ã£o inline** | Duplo-clique na cÃ©lula para editar (se permitido) |
| **Redimensionar** | Arrastar borda superior para expandir/retrair |
| **Colunas** | Mostrar/ocultar colunas, reordenar |
| **Exportar** | CSV, GeoJSON, Excel |

#### Estados da Tabela

```typescript
interface AttributeTableState {
  layerId: number | null;           // Camada ativa
  isOpen: boolean;                  // Painel aberto/fechado
  height: number;                   // Altura do painel (px)
  page: number;                     // PÃ¡gina atual
  pageSize: 25 | 50 | 100;          // Registros por pÃ¡gina
  sortColumn: string | null;        // Coluna de ordenaÃ§Ã£o
  sortDirection: 'asc' | 'desc';    // DireÃ§Ã£o
  filter: string;                   // Filtro de texto
  sqlFilter: string | null;         // Filtro SQL avanÃ§ado
  selectedRows: Set<number>;        // IDs selecionados
  visibleColumns: string[];         // Colunas visÃ­veis
  columnOrder: string[];            // Ordem das colunas
}
```

### 5. Painel de Atributos do Objeto (Feature Panel)

Painel flutuante que mostra detalhes de uma feature selecionada. **JÃ¡ implementado parcialmente em `FeaturePanel.tsx`**.

#### Melhorias Planejadas

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Feature #42          [â—€ 3/5 â–¶] [âœ•] â”‚  â† NavegaÃ§Ã£o entre selecionados
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ ğŸ“ Polygon (MultiPolygon)          â”‚
â”‚    VÃ©rtices: 24                     â”‚
â”‚    Ãrea: 1.234,56 mÂ²                â”‚
â”‚    PerÃ­metro: 156,7 m               â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ ATRIBUTOS                           â”‚
â”‚ â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
â”‚ â”‚ inscricao   â”‚ 001.001.001    âœ â”‚ â”‚
â”‚ â”‚ area        â”‚ 450.5          âœ â”‚ â”‚
â”‚ â”‚ bairro      â”‚ Centro         âœ â”‚ â”‚
â”‚ â”‚ proprietarioâ”‚ JoÃ£o Silva     âœ â”‚ â”‚
â”‚ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ [ğŸ” Zoom] [ğŸ“‹ Copiar] [ğŸ—‘ï¸ Excluir] â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

#### Funcionalidades do Feature Panel

| Funcionalidade | DescriÃ§Ã£o |
|----------------|-----------|
| **NavegaÃ§Ã£o** | Setas para navegar entre mÃºltiplas features selecionadas |
| **Info geomÃ©trica** | Tipo, vÃ©rtices, Ã¡rea, perÃ­metro calculados |
| **EdiÃ§Ã£o inline** | Clicar no valor para editar |
| **Adicionar atributo** | BotÃ£o para criar nova propriedade |
| **Zoom para feature** | Centraliza e faz zoom na feature |
| **Copiar atributos** | Copia JSON dos atributos |
| **Destacar no mapa** | Highlight visual da feature |
| **Abrir na tabela** | Abre tabela de atributos e seleciona a linha |

---

## Fluxos de InteraÃ§Ã£o

### Fluxo 1: Ativar Snap com ConfiguraÃ§Ã£o

```
1. UsuÃ¡rio clica no Ã­cone ğŸ§² (Snap) no Ribbon
2. Popover abre abaixo do Ã­cone
3. Popover mostra:
   - Toggle: Snap Ativado â˜‘
   - Modo: [VÃ©rtice â–¼] (dropdown)
   - DistÃ¢ncia: [15] px
   - Toggle: Guias Ortogonais â˜
4. UsuÃ¡rio modifica opÃ§Ãµes
5. Clica fora â†’ Popover fecha
6. ConfiguraÃ§Ãµes aplicadas imediatamente
```

### Fluxo 2: OperaÃ§Ã£o Dependente (Cortar PolÃ­gono)

```
1. UsuÃ¡rio seleciona um polÃ­gono no mapa
2. Painel flutuante "PolÃ­gono" aparece (posiÃ§Ã£o esquerda)
3. Painel mostra operaÃ§Ãµes disponÃ­veis:
   - âœ‚ï¸ Cortar
   - ğŸ”— Unir (desabilitado - precisa 2+)
   - â– Subtrair (desabilitado - precisa 2)
   - ğŸ“ Buffer
4. UsuÃ¡rio clica "Cortar"
5. Modo de corte ativado
6. Painel muda para mostrar:
   - "Desenhe a linha de corte"
   - [Cancelar] [Confirmar]
7. UsuÃ¡rio desenha linha
8. Clica Confirmar â†’ PolÃ­gono cortado
9. Painel retorna ao estado anterior
```

### Fluxo 3: Desenhar com OpÃ§Ãµes

```
1. UsuÃ¡rio clica em "PolÃ­gono" no Ribbon (aba Desenho)
2. Popover abre com opÃ§Ãµes:
   - â˜ Permitir buracos
   - â˜ Permitir auto-interseÃ§Ã£o
   - Unidade: [metros â–¼]
3. UsuÃ¡rio configura e clica fora
4. ComeÃ§a a desenhar no mapa
5. Painel flutuante "Desenhando PolÃ­gono" aparece:
   - VÃ©rtices: 5
   - PerÃ­metro: 234.5m
   - Ãrea: 1.234mÂ²
   - [Cancelar] [Finalizar]
6. Duplo-clique ou "Finalizar" â†’ PolÃ­gono criado
```

### Fluxo 4: Abrir Tabela de Atributos

```
1. UsuÃ¡rio clica com botÃ£o direito na camada "Lotes" no LayerPanel
2. Menu de contexto aparece:
   - ğŸ“‹ Abrir tabela de atributos
   - ğŸ” Zoom para camada
   - âš™ï¸ Propriedades
3. UsuÃ¡rio clica "Abrir tabela de atributos"
4. Painel inferior expande com a tabela
5. Dados carregam com paginaÃ§Ã£o (25 por pÃ¡gina)
6. UsuÃ¡rio pode:
   - Clicar em linha â†’ Feature selecionada no mapa
   - Duplo-clique â†’ Zoom para feature
   - Ctrl+clique â†’ SeleÃ§Ã£o mÃºltipla
   - Clicar cabeÃ§alho â†’ Ordenar
   - Digitar no filtro â†’ Filtrar registros
```

### Fluxo 5: Selecionar Feature e Ver Atributos

```
1. UsuÃ¡rio clica em uma feature no mapa
2. Feature Ã© destacada (highlight)
3. FeaturePanel aparece no canto inferior direito
4. Painel mostra:
   - Tipo de geometria e mÃ©tricas
   - Lista de atributos editÃ¡veis
5. Se tabela de atributos estiver aberta:
   - Linha correspondente Ã© destacada
   - Scroll automÃ¡tico para a linha
6. UsuÃ¡rio pode:
   - Editar atributos inline
   - Navegar entre features selecionadas
   - Fazer zoom para a feature
   - Excluir a feature
```

### Fluxo 6: Filtrar e Exportar da Tabela

```
1. Tabela de atributos aberta com camada "Lotes"
2. UsuÃ¡rio digita "Centro" no campo de filtro
3. Tabela filtra mostrando apenas lotes do bairro Centro
4. UsuÃ¡rio clica no Ã­cone de exportaÃ§Ã£o (â¬‡ï¸)
5. Menu aparece:
   - ğŸ“„ Exportar CSV
   - ğŸ—ºï¸ Exportar GeoJSON
   - ğŸ“Š Exportar Excel
   - (OpÃ§Ã£o: "Apenas filtrados" ou "Todos")
6. UsuÃ¡rio escolhe formato
7. Arquivo Ã© baixado
```

---

## EspecificaÃ§Ãµes TÃ©cnicas

### DimensÃµes

| Elemento | Altura | Largura |
|----------|--------|---------|
| Compact Ribbon | 48px | 100% |
| Ãcone do Ribbon | 32px | 32px |
| Popover | auto (max 300px) | 200-280px |
| Painel Flutuante | auto | 200-250px |
| Status Bar | 24px | 100% |

### Z-Index

| Elemento | Z-Index |
|----------|---------|
| Mapa (deck.gl) | 0 |
| PainÃ©is Flutuantes | 100 |
| Popovers | 200 |
| Modais | 300 |
| Tooltips | 400 |

### Cores (Dark Theme)

```css
:root {
  --bg-ribbon: #1e1e1e;
  --bg-ribbon-hover: #2d2d2d;
  --bg-popover: #252526;
  --bg-floating-panel: #1e1e1e;
  --bg-status-bar: #007acc;

  --border-subtle: #3c3c3c;
  --border-active: #007acc;

  --text-primary: #cccccc;
  --text-secondary: #858585;
  --text-active: #ffffff;

  --accent-primary: #007acc;
  --accent-success: #4ec9b0;
  --accent-warning: #dcdcaa;
  --accent-danger: #f14c4c;
}
```

### Breakpoints Responsivos

| Breakpoint | Comportamento |
|------------|---------------|
| > 1200px | Layout completo |
| 900-1200px | Ribbon com Ã­cones menores, labels ocultos |
| < 900px | Ribbon colapsado em menu hamburguer |

---

## Estrutura de Componentes React

```
src/
â”œâ”€â”€ components/
â”‚   â”œâ”€â”€ layout/
â”‚   â”‚   â”œâ”€â”€ AppLayout.tsx              # Layout com react-resizable-panels
â”‚   â”‚   â”œâ”€â”€ CompactRibbon/
â”‚   â”‚   â”‚   â”œâ”€â”€ CompactRibbon.tsx      # Container do ribbon
â”‚   â”‚   â”‚   â”œâ”€â”€ RibbonTab.tsx          # Aba individual
â”‚   â”‚   â”‚   â”œâ”€â”€ RibbonGroup.tsx        # Grupo de Ã­cones
â”‚   â”‚   â”‚   â””â”€â”€ RibbonButton.tsx       # BotÃ£o com popover
â”‚   â”‚   â”œâ”€â”€ SelectionPanel/            # NOVO - Painel Esquerdo
â”‚   â”‚   â”‚   â”œâ”€â”€ SelectionPanel.tsx     # Container do painel de seleÃ§Ã£o
â”‚   â”‚   â”‚   â”œâ”€â”€ SelectionList.tsx      # Lista de objetos selecionados
â”‚   â”‚   â”‚   â”œâ”€â”€ SelectionDetails.tsx   # Detalhes do objeto ativo
â”‚   â”‚   â”‚   â”œâ”€â”€ SelectionActions.tsx   # BotÃµes: Todos, Limpar, Inverter
â”‚   â”‚   â”‚   â”œâ”€â”€ EditTools.tsx          # Ferramentas de ediÃ§Ã£o contextual
â”‚   â”‚   â”‚   â”œâ”€â”€ OperationsPanel.tsx    # OperaÃ§Ãµes espaciais (Cortar, Unir, etc)
â”‚   â”‚   â”‚   â”œâ”€â”€ DrawingInfo.tsx        # Info durante desenho ativo
â”‚   â”‚   â”‚   â””â”€â”€ EditHistory.tsx        # HistÃ³rico de ediÃ§Ãµes
â”‚   â”‚   â”œâ”€â”€ TaskPane/                  # Painel Direito
â”‚   â”‚   â”‚   â”œâ”€â”€ TaskPane.tsx           # Container do Task Pane
â”‚   â”‚   â”‚   â”œâ”€â”€ TaskPaneTab.tsx        # Aba do Task Pane
â”‚   â”‚   â”‚   â”œâ”€â”€ LayersTab.tsx          # Aba Camadas (usa headless-tree)
â”‚   â”‚   â”‚   â”œâ”€â”€ AttributesTab.tsx      # Aba Atributos (preview)
â”‚   â”‚   â”‚   â””â”€â”€ AnalysisTab.tsx        # Aba AnÃ¡lise
â”‚   â”‚   â””â”€â”€ StatusBar/
â”‚   â”‚       â””â”€â”€ StatusBar.tsx
â”‚   â”œâ”€â”€ layers/
â”‚   â”‚   â”œâ”€â”€ LayerTree.tsx              # Ãrvore com headless-tree
â”‚   â”‚   â”œâ”€â”€ LayerTreeItem.tsx          # Item customizado da Ã¡rvore
â”‚   â”‚   â”œâ”€â”€ LayerControls.tsx          # Controles: ğŸ‘ï¸ ğŸ–±ï¸ ğŸ”“ ğŸ”
â”‚   â”‚   â”œâ”€â”€ LayerLegend.tsx            # Legenda das camadas visÃ­veis
â”‚   â”‚   â””â”€â”€ LayerContextMenu.tsx       # Menu de contexto
â”‚   â”œâ”€â”€ selection/                     # NOVO - Componentes de seleÃ§Ã£o
â”‚   â”‚   â”œâ”€â”€ SelectedFeatureItem.tsx    # Item na lista de selecionados
â”‚   â”‚   â”œâ”€â”€ FeatureDetails.tsx         # Detalhes expandidos
â”‚   â”‚   â”œâ”€â”€ GeometryMetrics.tsx        # Ãrea, perÃ­metro, vÃ©rtices
â”‚   â”‚   â””â”€â”€ AttributeEditor.tsx        # Editor inline de atributos
â”‚   â”œâ”€â”€ attributes/
â”‚   â”‚   â”œâ”€â”€ AttributeTable/
â”‚   â”‚   â”‚   â”œâ”€â”€ AttributeTable.tsx     # Container principal
â”‚   â”‚   â”‚   â”œâ”€â”€ TableHeader.tsx        # CabeÃ§alho com ordenaÃ§Ã£o
â”‚   â”‚   â”‚   â”œâ”€â”€ TableRow.tsx           # Linha com seleÃ§Ã£o/ediÃ§Ã£o
â”‚   â”‚   â”‚   â”œâ”€â”€ TablePagination.tsx    # Controles de paginaÃ§Ã£o
â”‚   â”‚   â”‚   â”œâ”€â”€ TableFilter.tsx        # Campo de filtro
â”‚   â”‚   â”‚   â””â”€â”€ TableToolbar.tsx       # Toolbar (exportar, colunas)
â”‚   â”‚   â””â”€â”€ AttributePreview.tsx       # Mini-tabela no Task Pane
â”‚   â”œâ”€â”€ operations/                    # NOVO - PainÃ©is de operaÃ§Ãµes
â”‚   â”‚   â”œâ”€â”€ BufferConfig.tsx           # ConfiguraÃ§Ã£o de buffer
â”‚   â”‚   â”œâ”€â”€ SplitConfig.tsx            # ConfiguraÃ§Ã£o de corte
â”‚   â”‚   â”œâ”€â”€ MergeConfig.tsx            # ConfiguraÃ§Ã£o de uniÃ£o
â”‚   â”‚   â””â”€â”€ MeasureDisplay.tsx         # ExibiÃ§Ã£o de mediÃ§Ã£o
â”‚   â”œâ”€â”€ popovers/
â”‚   â”‚   â”œâ”€â”€ Popover.tsx                # Componente base
â”‚   â”‚   â”œâ”€â”€ SnapPopover.tsx            # ConfiguraÃ§Ãµes de snap
â”‚   â”‚   â””â”€â”€ DrawOptionsPopover.tsx     # OpÃ§Ãµes de desenho
â”‚   â””â”€â”€ map/
â”‚       â””â”€â”€ MapView.tsx                # deck.gl + MapLibre
â”œâ”€â”€ hooks/
â”‚   â”œâ”€â”€ useLayerTree.ts                # Hook para headless-tree
â”‚   â”œâ”€â”€ useSelection.ts                # NOVO - Gerencia seleÃ§Ã£o de features
â”‚   â”œâ”€â”€ useLayerState.ts               # NOVO - Estados das camadas (visible, selectable, editable)
â”‚   â”œâ”€â”€ useAttributeData.ts            # Busca dados paginados
â”‚   â”œâ”€â”€ useTableSelection.ts           # SeleÃ§Ã£o sincronizada mapaâ†”tabela
â”‚   â”œâ”€â”€ useExport.ts                   # ExportaÃ§Ã£o CSV/GeoJSON
â”‚   â”œâ”€â”€ usePanelLayout.ts              # Controle dos painÃ©is
â”‚   â””â”€â”€ useEditPermissions.ts          # NOVO - Verifica permissÃµes de ediÃ§Ã£o
â””â”€â”€ store/
    â”œâ”€â”€ index.ts                       # Store principal (zustand)
    â”œâ”€â”€ slices/
    â”‚   â”œâ”€â”€ layerSlice.ts              # Estado das camadas + controles
    â”‚   â”œâ”€â”€ selectionSlice.ts          # Estado da seleÃ§Ã£o
    â”‚   â”œâ”€â”€ editorSlice.ts             # Estado do editor
    â”‚   â”œâ”€â”€ uiSlice.ts                 # Estado da UI (painÃ©is, abas)
    â”‚   â””â”€â”€ historySlice.ts            # HistÃ³rico de operaÃ§Ãµes
    â””â”€â”€ types.ts                       # Tipos compartilhados
```

### ImplementaÃ§Ã£o do AppLayout.tsx

```tsx
// src/components/layout/AppLayout.tsx
import { useRef, useEffect } from 'react';
import {
  Panel,
  PanelGroup,
  PanelResizeHandle,
  ImperativePanelHandle,
} from 'react-resizable-panels';
import { CompactRibbon } from './CompactRibbon/CompactRibbon';
import { SelectionPanel } from './SelectionPanel/SelectionPanel';
import { TaskPane } from './TaskPane/TaskPane';
import { StatusBar } from './StatusBar/StatusBar';
import { MapView } from '../map/MapView';
import { AttributeTable } from '../attributes/AttributeTable/AttributeTable';
import { useStore } from '../../store';

export function AppLayout() {
  const selectionPanelRef = useRef<ImperativePanelHandle>(null);
  const taskPaneRef = useRef<ImperativePanelHandle>(null);
  const tablePanelRef = useRef<ImperativePanelHandle>(null);

  const {
    isTableOpen,
    activeTableLayer,
    selectedFeatures,  // Features selecionadas
    isDrawing,         // EstÃ¡ desenhando?
  } = useStore();

  // Auto-expandir/colapsar Selection Panel baseado na seleÃ§Ã£o
  useEffect(() => {
    const panel = selectionPanelRef.current;
    if (!panel) return;

    const hasSelection = selectedFeatures.length > 0 || isDrawing;

    if (hasSelection && panel.isCollapsed()) {
      panel.expand();
    } else if (!hasSelection && !panel.isCollapsed()) {
      panel.collapse();
    }
  }, [selectedFeatures.length, isDrawing]);

  return (
    <div className="h-screen flex flex-col bg-dark text-white">
      {/* Ribbon fixo no topo */}
      <CompactRibbon />

      {/* Ãrea principal com painÃ©is redimensionÃ¡veis */}
      <PanelGroup
        direction="vertical"
        autoSaveId="main-vertical"
        className="flex-1"
      >
        {/* Painel superior: Selection + Mapa + Task Pane */}
        <Panel defaultSize={70} minSize={40}>
          <PanelGroup
            direction="horizontal"
            autoSaveId="main-horizontal"
          >
            {/* Selection Panel (Esquerda) - contextual */}
            <Panel
              ref={selectionPanelRef}
              defaultSize={4}  // ComeÃ§a colapsado
              minSize={4}
              maxSize={25}
              collapsible
              collapsedSize={4}
            >
              <SelectionPanel
                isCollapsed={selectionPanelRef.current?.isCollapsed() ?? true}
                onToggleCollapse={() => {
                  const panel = selectionPanelRef.current;
                  if (panel?.isCollapsed()) {
                    panel.expand();
                  } else {
                    panel?.collapse();
                  }
                }}
              />
            </Panel>

            {/* Resize handle entre Selection e Mapa */}
            <PanelResizeHandle className="w-1 bg-gray-800 hover:bg-primary transition-colors" />

            {/* Ãrea do Mapa (Centro) */}
            <Panel defaultSize={71} minSize={40}>
              <MapView />
            </Panel>

            {/* Resize handle entre Mapa e Task Pane */}
            <PanelResizeHandle className="w-1 bg-gray-800 hover:bg-primary transition-colors" />

            {/* Task Pane (Direita) - colapsÃ¡vel */}
            <Panel
              ref={taskPaneRef}
              defaultSize={25}
              minSize={4}
              maxSize={35}
              collapsible
              collapsedSize={4}
            >
              <TaskPane
                isCollapsed={taskPaneRef.current?.isCollapsed() ?? false}
                onToggleCollapse={() => {
                  const panel = taskPaneRef.current;
                  if (panel?.isCollapsed()) {
                    panel.expand();
                  } else {
                    panel?.collapse();
                  }
                }}
              />
            </Panel>
          </PanelGroup>
        </Panel>

        {/* Resize handle entre Mapa e Tabela */}
        {isTableOpen && (
          <PanelResizeHandle className="h-1 bg-gray-800 hover:bg-primary transition-colors" />
        )}

        {/* Tabela de Atributos (Inferior) - colapsÃ¡vel */}
        {isTableOpen && (
          <Panel
            ref={tablePanelRef}
            defaultSize={30}
            minSize={10}
            maxSize={60}
            collapsible
            collapsedSize={3}
          >
            <AttributeTable layerId={activeTableLayer} />
          </Panel>
        )}
      </PanelGroup>

      {/* Status Bar fixo no rodapÃ© */}
      <StatusBar />
    </div>
  );
}
```

### ImplementaÃ§Ã£o do SelectionPanel.tsx

```tsx
// src/components/layout/SelectionPanel/SelectionPanel.tsx
import { useStore } from '../../../store';
import { SelectionList } from './SelectionList';
import { SelectionDetails } from './SelectionDetails';
import { EditTools } from './EditTools';
import { OperationsPanel } from './OperationsPanel';
import { EditHistory } from './EditHistory';
import { DrawingInfo } from './DrawingInfo';

interface SelectionPanelProps {
  isCollapsed: boolean;
  onToggleCollapse: () => void;
}

export function SelectionPanel({ isCollapsed, onToggleCollapse }: SelectionPanelProps) {
  const {
    selectedFeatures,
    activeFeatureIndex,
    isDrawing,
    drawingInfo,
    editHistory,
  } = useStore();

  // Painel colapsado - apenas Ã­cone
  if (isCollapsed) {
    return (
      <div className="h-full bg-secondary flex flex-col items-center py-2">
        <button
          onClick={onToggleCollapse}
          className="p-2 hover:bg-gray-700 rounded"
          title="Expandir painel de seleÃ§Ã£o"
        >
          â–¶
        </button>
        {selectedFeatures.length > 0 && (
          <div className="mt-2 text-xs text-primary font-bold">
            {selectedFeatures.length}
          </div>
        )}
      </div>
    );
  }

  // Durante desenho - mostra info do desenho
  if (isDrawing) {
    return (
      <div className="h-full bg-secondary flex flex-col overflow-hidden">
        <div className="p-3 border-b border-gray-700 flex items-center justify-between">
          <span className="font-semibold text-sm">â–¶ DESENHANDO</span>
          <button onClick={onToggleCollapse} className="text-gray-400 hover:text-white">
            âœ•
          </button>
        </div>
        <div className="flex-1 overflow-y-auto">
          <DrawingInfo info={drawingInfo} />
        </div>
      </div>
    );
  }

  // Painel expandido - conteÃºdo completo
  return (
    <div className="h-full bg-secondary flex flex-col overflow-hidden">
      {/* Header */}
      <div className="p-3 border-b border-gray-700 flex items-center justify-between">
        <span className="font-semibold text-sm">â–¶ SELEÃ‡ÃƒO & EDIÃ‡ÃƒO</span>
        <button onClick={onToggleCollapse} className="text-gray-400 hover:text-white">
          âœ•
        </button>
      </div>

      {/* ConteÃºdo com scroll */}
      <div className="flex-1 overflow-y-auto">
        {selectedFeatures.length === 0 ? (
          <div className="p-4 text-center text-gray-500 text-sm">
            <div className="text-2xl mb-2">ğŸ–±ï¸</div>
            <div>Nenhum objeto selecionado</div>
            <div className="text-xs mt-1">
              Use as ferramentas de seleÃ§Ã£o para escolher objetos no mapa
            </div>
          </div>
        ) : (
          <>
            {/* Lista de selecionados */}
            <SelectionList features={selectedFeatures} />

            {/* Detalhes do objeto ativo */}
            {activeFeatureIndex !== null && (
              <SelectionDetails
                feature={selectedFeatures[activeFeatureIndex]}
                index={activeFeatureIndex}
                total={selectedFeatures.length}
              />
            )}

            {/* Ferramentas de ediÃ§Ã£o */}
            <EditTools features={selectedFeatures} />

            {/* OperaÃ§Ãµes espaciais */}
            <OperationsPanel features={selectedFeatures} />

            {/* HistÃ³rico de ediÃ§Ã£o */}
            <EditHistory entries={editHistory} />
          </>
        )}
      </div>
    </div>
  );
}
```

### ImplementaÃ§Ã£o do LayerTree.tsx com headless-tree

```tsx
// src/components/layers/LayerTree.tsx
import { useTree } from '@headless-tree/react';
import {
  dragAndDropFeature,
  selectionFeature,
  renamingFeature,
  hotkeysCoreFeature,
  searchFeature,
} from '@headless-tree/core';
import { useStore } from '../../store';
import { LayerTreeItem } from './LayerTreeItem';

interface LayerItem {
  id: string;
  name: string;
  type: 'group' | 'layer';
  visible: boolean;
  color?: string;
  featureCount?: number;
  parentId: string | null;
}

export function LayerTree() {
  const { layers, reorderLayers, renameLayer, toggleLayerVisibility } = useStore();

  const tree = useTree<LayerItem>({
    rootItemId: 'root',
    getItemName: (item) => item.name,
    isItemFolder: (item) => item.type === 'group',
    dataLoader: {
      getItem: (id) => layers.find((l) => l.id === id) || null,
      getChildren: (id) =>
        id === 'root'
          ? layers.filter((l) => l.parentId === null).map((l) => l.id)
          : layers.filter((l) => l.parentId === id).map((l) => l.id),
    },
    features: [
      // Drag-and-drop para reordenar
      dragAndDropFeature({
        onDrop: (items, target) => {
          reorderLayers(
            items.map((i) => i.id),
            target.targetItem,
            target.insertionIndex
          );
        },
      }),
      // SeleÃ§Ã£o mÃºltipla
      selectionFeature({ mode: 'multiple' }),
      // Renomear com F2 ou duplo-clique
      renamingFeature({
        onRename: (item, newName) => renameLayer(item.id, newName),
      }),
      // Atalhos de teclado
      hotkeysCoreFeature(),
      // Busca por digitaÃ§Ã£o
      searchFeature(),
    ],
  });

  return (
    <div className="flex flex-col h-full">
      {/* Campo de busca */}
      <div className="p-2 border-b border-gray-700">
        <input
          type="text"
          placeholder="ğŸ” Buscar camada..."
          className="w-full px-3 py-1.5 bg-gray-800 rounded text-sm"
          onChange={(e) => tree.setSearch(e.target.value)}
        />
      </div>

      {/* Ãrvore de camadas */}
      <div
        className="flex-1 overflow-auto p-2"
        {...tree.getContainerProps()}
      >
        {tree.renderedItems.map((item) => (
          <LayerTreeItem
            key={item.id}
            item={item}
            tree={tree}
            onToggleVisibility={() => toggleLayerVisibility(item.id)}
          />
        ))}
      </div>

      {/* AÃ§Ãµes */}
      <div className="p-2 border-t border-gray-700 flex gap-2">
        <button className="flex-1 px-3 py-1.5 bg-gray-700 hover:bg-gray-600 rounded text-xs">
          + Novo Grupo
        </button>
        <button className="flex-1 px-3 py-1.5 bg-primary hover:bg-primary/80 text-dark rounded text-xs">
          + Camada
        </button>
      </div>
    </div>
  );
}
```

---

## CondiÃ§Ãµes de ExibiÃ§Ã£o dos PainÃ©is

### Mapeamento Completo

```typescript
interface PanelCondition {
  panel: string;
  conditions: {
    selectedTypes?: ('Point' | 'LineString' | 'Polygon')[];
    selectedCount?: { min?: number; max?: number };
    activeMode?: EditModeType[];
    customCheck?: (state: AppState) => boolean;
  };
}

const panelConditions: PanelCondition[] = [
  {
    panel: 'PolygonOpsPanel',
    conditions: {
      selectedTypes: ['Polygon'],
      selectedCount: { min: 1 },
    },
  },
  {
    panel: 'MultiPolygonOpsPanel',
    conditions: {
      selectedTypes: ['Polygon'],
      selectedCount: { min: 2 },
    },
  },
  {
    panel: 'LineOpsPanel',
    conditions: {
      selectedTypes: ['LineString'],
      selectedCount: { min: 1 },
    },
  },
  {
    panel: 'DrawingInfoPanel',
    conditions: {
      activeMode: [
        'draw-point',
        'draw-line',
        'draw-polygon',
        'draw-rectangle',
        'draw-circle',
      ],
    },
  },
  {
    panel: 'MeasurePanel',
    conditions: {
      activeMode: ['measure-distance', 'measure-area', 'measure-angle'],
    },
  },
  {
    panel: 'SplitPolygonPanel',
    conditions: {
      activeMode: ['split-polygon'],
      customCheck: (state) => state.selectedFeatureIndexes.length === 1,
    },
  },
];
```

---

## OperaÃ§Ãµes por Tipo de Geometria

### Ponto (Point)

| OperaÃ§Ã£o | Ãcone | DescriÃ§Ã£o |
|----------|-------|-----------|
| Mover | â†”ï¸ | Reposicionar ponto |
| Duplicar | ğŸ“‹ | Criar cÃ³pia |
| Buffer | â­• | Criar cÃ­rculo ao redor |
| Deletar | ğŸ—‘ï¸ | Remover ponto |

### Linha (LineString)

| OperaÃ§Ã£o | Ãcone | DescriÃ§Ã£o |
|----------|-------|-----------|
| Estender | â¡ï¸ | Adicionar vÃ©rtices no fim |
| Dividir | âœ‚ï¸ | Cortar em ponto |
| Simplificar | ã€°ï¸ | Reduzir vÃ©rtices |
| Buffer | â¬œ | Criar polÃ­gono ao redor |
| Inverter | ğŸ”„ | Inverter direÃ§Ã£o |
| Unir | ğŸ”— | Conectar linhas (2+) |
| Medir | ğŸ“ | Comprimento total |

### PolÃ­gono (Polygon)

| OperaÃ§Ã£o | Ãcone | DescriÃ§Ã£o |
|----------|-------|-----------|
| Cortar | âœ‚ï¸ | Dividir com linha |
| Unir | ğŸ”— | Merge (2+) |
| Subtrair | â– | DiferenÃ§a (2) |
| InterseÃ§Ã£o | âˆ© | Ãrea comum (2) |
| Buffer | â¬œ | Expandir/contrair |
| Simplificar | ã€°ï¸ | Reduzir vÃ©rtices |
| Buraco | â­• | Adicionar hole |
| Medir | ğŸ“ | Ãrea e perÃ­metro |

---

## Atalhos de Teclado

### Globais

| Tecla | AÃ§Ã£o |
|-------|------|
| `Escape` | Cancelar operaÃ§Ã£o / Desselecionar |
| `Delete` | Deletar selecionados |
| `Ctrl+C` | Copiar |
| `Ctrl+V` | Colar |
| `Ctrl+Z` | Abrir histÃ³rico (nÃ£o desfaz direto) |
| `Space` | Alternar entre View e Ãºltimo modo |
| `F6` | Abrir/fechar tabela de atributos da camada ativa |

### Por Contexto

| Tecla | Contexto | AÃ§Ã£o |
|-------|----------|------|
| `Enter` | Desenhando | Finalizar geometria |
| `Backspace` | Desenhando | Remover Ãºltimo vÃ©rtice |
| `S` | Qualquer | Toggle Snap |
| `G` | Snap ativo | Toggle Guias |

### Tabela de Atributos

| Tecla | Contexto | AÃ§Ã£o |
|-------|----------|------|
| `â†‘` / `â†“` | Tabela focada | Navegar entre linhas |
| `Enter` | Linha selecionada | Zoom para feature |
| `Ctrl+A` | Tabela focada | Selecionar todas as linhas |
| `Ctrl+Shift+A` | Tabela focada | Limpar seleÃ§Ã£o |
| `Ctrl+F` | Tabela focada | Focar no campo de filtro |
| `Ctrl+E` | Tabela focada | Exportar dados |
| `F2` | CÃ©lula selecionada | Editar cÃ©lula |

### Feature Panel

| Tecla | Contexto | AÃ§Ã£o |
|-------|----------|------|
| `â†` / `â†’` | Panel aberto | Navegar entre features selecionadas |
| `Z` | Panel aberto | Zoom para feature |
| `E` | Panel aberto | Editar primeiro atributo |

---

## Fases de ImplementaÃ§Ã£o

### Fase 1: Estrutura Base e Layout
- [ ] Instalar dependÃªncias: `react-resizable-panels`, `@headless-tree/core`, `@headless-tree/react`
- [ ] Criar `AppLayout.tsx` com 3 painÃ©is redimensionÃ¡veis (esquerda, centro, direita)
- [ ] Implementar `CompactRibbon` bÃ¡sico (Desenho, SeleÃ§Ã£o, Snap, Arquivo)
- [ ] Implementar `StatusBar`
- [ ] Configurar persistÃªncia de layout no localStorage

### Fase 2: Selection Panel (Esquerda)
- [ ] Criar `SelectionPanel.tsx` com comportamento contextual (colapsa sem seleÃ§Ã£o)
- [ ] Implementar `SelectionList.tsx` - lista de objetos selecionados agrupados por camada
- [ ] Implementar `SelectionDetails.tsx` - detalhes do objeto ativo com navegaÃ§Ã£o â—€ â–¶
- [ ] Implementar `GeometryMetrics.tsx` - cÃ¡lculo de Ã¡rea, perÃ­metro, vÃ©rtices
- [ ] Implementar `EditTools.tsx` - ferramentas de ediÃ§Ã£o respeitando permissÃµes
- [ ] Implementar `OperationsPanel.tsx` - operaÃ§Ãµes espaciais contextuais
- [ ] Implementar `EditHistory.tsx` - histÃ³rico com undo/redo
- [ ] Implementar `DrawingInfo.tsx` - info durante desenho ativo

### Fase 3: Task Pane (Direita)
- [ ] Criar `TaskPane.tsx` com sistema de abas colapsÃ¡vel
- [ ] Implementar `LayersTab.tsx` com headless-tree
- [ ] Implementar controles de camada: ğŸ‘ï¸ visÃ­vel, ğŸ–±ï¸ selecionÃ¡vel, ğŸ”“ editÃ¡vel, ğŸ” zoom
- [ ] Implementar `LayerContextMenu.tsx` - menu de contexto
- [ ] Implementar `LayerLegend.tsx` - legenda das camadas visÃ­veis
- [ ] Implementar `AttributesTab.tsx` - preview de atributos
- [ ] Implementar `AnalysisTab.tsx` - ferramentas de anÃ¡lise

### Fase 4: IntegraÃ§Ã£o SeleÃ§Ã£o â†” Camadas
- [ ] Criar `useSelection.ts` - hook de gerenciamento de seleÃ§Ã£o
- [ ] Criar `useLayerState.ts` - hook de estados das camadas
- [ ] Criar `useEditPermissions.ts` - verificaÃ§Ã£o de permissÃµes
- [ ] Integrar seleÃ§Ã£o com estado de camadas (sÃ³ seleciona se `selectable`)
- [ ] Integrar ediÃ§Ã£o com estado de camadas (sÃ³ edita se `editable`)
- [ ] Implementar propagaÃ§Ã£o de estado em grupos

### Fase 5: Tabela de Atributos
- [ ] Criar `AttributeTable.tsx` com estrutura bÃ¡sica
- [ ] Implementar paginaÃ§Ã£o (busca via API com limit/offset)
- [ ] Implementar ordenaÃ§Ã£o por coluna
- [ ] Implementar filtro de texto
- [ ] Sincronizar seleÃ§Ã£o tabela â†” mapa â†” SelectionPanel
- [ ] Implementar zoom para feature (duplo-clique)
- [ ] Implementar redimensionamento do painel
- [ ] Criar seletor de colunas visÃ­veis
- [ ] Implementar ediÃ§Ã£o inline de cÃ©lulas
- [ ] Adicionar exportaÃ§Ã£o (CSV, GeoJSON)

### Fase 6: Sistema de Popovers (Ribbon)
- [ ] Criar componente `Popover` genÃ©rico
- [ ] Implementar `SnapPopover` - configuraÃ§Ãµes de snap
- [ ] Implementar `DrawOptionsPopover` - opÃ§Ãµes de desenho
- [ ] Implementar dropdowns para variantes de formas

### Fase 7: OperaÃ§Ãµes Geoespaciais
- [ ] Implementar cortar polÃ­gono (dentro do SelectionPanel)
- [ ] Implementar unir polÃ­gonos
- [ ] Implementar operaÃ§Ãµes booleanas (diferenÃ§a, interseÃ§Ã£o)
- [ ] Implementar buffer com preview
- [ ] Implementar simplificaÃ§Ã£o de geometria

### Fase 8: Polimento
- [ ] AnimaÃ§Ãµes de transiÃ§Ã£o (expandir/colapsar painÃ©is)
- [ ] Temas claro/escuro
- [ ] Responsividade (mobile: bottom sheet)
- [ ] Testes de usabilidade
- [ ] Atalhos de teclado completos
- [ ] Tooltips e ajuda contextual

---

## IntegraÃ§Ã£o com API (Tabela de Atributos)

A tabela de atributos precisa buscar dados do backend. O proxy jÃ¡ fornece endpoints adequados.

### Endpoints Utilizados

| Endpoint | Uso |
|----------|-----|
| `/api/projetos_camadas/{id}/tabela` | Buscar registros paginados |
| `/api/projetos_camadas/{id}/tabela/count` | Contar total de registros |
| `/tiles/dynamic/{z}/{x}/{y}.pbf` | Tiles para visualizaÃ§Ã£o no mapa |

### ParÃ¢metros de PaginaÃ§Ã£o

```typescript
interface TableQueryParams {
  page: number;           // PÃ¡gina atual (1-indexed)
  per_page: number;       // Registros por pÃ¡gina (25, 50, 100)
  sort_by?: string;       // Coluna de ordenaÃ§Ã£o
  sort_order?: 'asc' | 'desc';
  filter?: string;        // Filtro de texto (busca em todas as colunas)
  fields?: string;        // Colunas especÃ­ficas (comma-separated)
}
```

### Resposta Esperada

```typescript
interface TableResponse {
  data: Record<string, any>[];  // Array de registros
  meta: {
    total: number;              // Total de registros
    page: number;               // PÃ¡gina atual
    per_page: number;           // Registros por pÃ¡gina
    total_pages: number;        // Total de pÃ¡ginas
  };
}
```

### Hook de Busca

```typescript
// src/components/attributes/hooks/useAttributeData.ts
export function useAttributeData(layerId: number, params: TableQueryParams) {
  const [data, setData] = useState<TableResponse | null>(null);
  const [loading, setLoading] = useState(false);
  const [error, setError] = useState<Error | null>(null);

  useEffect(() => {
    // Debounce para evitar muitas requisiÃ§Ãµes durante filtro
    const timeoutId = setTimeout(() => {
      fetchData(layerId, params)
        .then(setData)
        .catch(setError)
        .finally(() => setLoading(false));
    }, 300);

    return () => clearTimeout(timeoutId);
  }, [layerId, params]);

  return { data, loading, error };
}
```

### SincronizaÃ§Ã£o Mapa â†” Tabela

```typescript
// Quando usuÃ¡rio seleciona no mapa
onFeatureClick(feature) {
  const featureId = feature.properties.id;
  tableStore.highlightRow(featureId);
  tableStore.scrollToRow(featureId);
}

// Quando usuÃ¡rio seleciona na tabela
onRowClick(row) {
  const featureId = row.id;
  mapStore.selectFeature(featureId);
  mapStore.highlightFeature(featureId);
}

// Quando usuÃ¡rio dÃ¡ duplo-clique na tabela
onRowDoubleClick(row) {
  const featureId = row.id;
  const bbox = row.geometry_bbox; // Precisa vir da API
  mapStore.zoomToBbox(bbox);
}
```

---

## AnÃ¡lise: Task Pane (Autodesk Map 3D) vs PainÃ©is Flutuantes

### Modelo Atual: PainÃ©is Flutuantes (Figma-style)

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ RIBBON                                                       â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                              â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                      â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”     â”‚
â”‚  â”‚ Painel Ops   â”‚                      â”‚ Feature      â”‚     â”‚
â”‚  â”‚ (contextual) â”‚       MAPA           â”‚ Panel        â”‚     â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                      â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜     â”‚
â”‚                                                              â”‚
â”‚              (painÃ©is aparecem/somem conforme contexto)      â”‚
â”‚                                                              â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ TABELA DE ATRIBUTOS (painel inferior)                       â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

**PrÃ³s:**
- MÃ¡ximo espaÃ§o para o mapa quando nÃ£o hÃ¡ seleÃ§Ã£o
- Contexto imediato - ferramentas aparecem onde sÃ£o relevantes
- Familiar para usuÃ¡rios de Figma/design tools

**Contras:**
- Pode ser confuso saber onde os painÃ©is vÃ£o aparecer
- MÃºltiplos painÃ©is podem sobrepor
- Menos previsÃ­vel

---

### Modelo Alternativo: Task Pane (Autodesk Map 3D-style)

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ RIBBON                                                               â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                      â”‚ TASK PANE    â”‚
â”‚                                                      â”‚ â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”â”‚
â”‚                                                      â”‚ â”‚[Camadas]  â”‚â”‚
â”‚                                                      â”‚ â”‚[Atributos]â”‚â”‚
â”‚                                                      â”‚ â”‚[AnÃ¡lise]  â”‚â”‚
â”‚                      MAPA                            â”‚ â”‚[HistÃ³rico]â”‚â”‚
â”‚                                                      â”‚ â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤â”‚
â”‚                                                      â”‚ â”‚           â”‚â”‚
â”‚                                                      â”‚ â”‚ ConteÃºdo  â”‚â”‚
â”‚                                                      â”‚ â”‚ da aba    â”‚â”‚
â”‚                                                      â”‚ â”‚ ativa     â”‚â”‚
â”‚                                                      â”‚ â”‚           â”‚â”‚
â”‚                                                      â”‚ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ STATUS BAR                                                           â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

O **Task Pane** do Autodesk Map 3D Ã© um painel lateral fixo com abas:

| Aba | ConteÃºdo | Equivalente no nosso sistema |
|-----|----------|------------------------------|
| **Display Manager** | Camadas, estilos, ordem | `LayerPanel.tsx` |
| **Map Explorer** | Fontes de dados, queries | Novo |
| **Data Table** | Tabela de atributos (abre ao clicar em camada) | `AttributeTable.tsx` |
| **Properties** | Atributos da feature selecionada | `FeaturePanel.tsx` |

**PrÃ³s:**
- Interface consistente e previsÃ­vel
- UsuÃ¡rio sempre sabe onde encontrar funcionalidades
- PadrÃ£o familiar para usuÃ¡rios de GIS (QGIS, ArcGIS, Map 3D)
- Melhor para workflows complexos e anÃ¡lises

**Contras:**
- Ocupa espaÃ§o lateral permanente (~280-320px)
- Menos eficiente em telas pequenas
- Pode parecer "pesado" para tarefas simples

---

### Proposta HÃ­brida: Task Pane ColapsÃ¡vel

Combina os dois modelos:

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ RIBBON                                                               â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                      â”‚â—€â”‚ TASK PANE  â”‚
â”‚                                                      â”‚ â”‚ â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”â”‚
â”‚                                                      â”‚ â”‚ â”‚ Abas    â”‚â”‚
â”‚                      MAPA                            â”‚ â”‚ â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤â”‚
â”‚                                                      â”‚ â”‚ â”‚         â”‚â”‚
â”‚                                                      â”‚ â”‚ â”‚ConteÃºdo â”‚â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                                  â”‚ â”‚ â”‚         â”‚â”‚
â”‚  â”‚ Painel de Ops  â”‚  (aparece sobre o mapa quando   â”‚ â”‚ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜â”‚
â”‚  â”‚ (contextual)   â”‚   operaÃ§Ã£o especÃ­fica ativa)    â”‚ â”‚            â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                                  â”‚ â”‚            â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ TABELA DE ATRIBUTOS (painel inferior, quando aberto)                â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

**Regras:**
1. **Task Pane** (lateral direita) - Sempre visÃ­vel, colapsÃ¡vel para Ã­cones
   - Aba "Camadas" - Gerenciamento de camadas
   - Aba "Atributos" - Feature selecionada + mini-tabela
   - Aba "AnÃ¡lise" - Ferramentas de anÃ¡lise espacial
   - Aba "HistÃ³rico" - Lista de operaÃ§Ãµes

2. **PainÃ©is Flutuantes** (sobre o mapa) - Apenas para operaÃ§Ãµes ativas
   - Desenho em progresso (vÃ©rtices, Ã¡rea, etc.)
   - Corte/UniÃ£o em andamento
   - MediÃ§Ã£o ativa

3. **Tabela de Atributos** (inferior) - Dados tabulares completos
   - Abre via Task Pane ou menu de contexto
   - Pode ser destacada como janela separada

---

### Estrutura do Task Pane Proposto

```typescript
interface TaskPaneTab {
  id: string;
  icon: string;
  label: string;
  component: React.ComponentType;
}

const taskPaneTabs: TaskPaneTab[] = [
  {
    id: 'layers',
    icon: 'ğŸ“‘',
    label: 'Camadas',
    component: LayerManager,  // Lista de camadas + controles
  },
  {
    id: 'attributes',
    icon: 'ğŸ“‹',
    label: 'Atributos',
    component: AttributeInspector,  // Feature selecionada + preview tabela
  },
  {
    id: 'analysis',
    icon: 'ğŸ“Š',
    label: 'AnÃ¡lise',
    component: AnalysisTools,  // Buffer, InterseÃ§Ã£o, etc.
  },
  {
    id: 'history',
    icon: 'ğŸ“œ',
    label: 'HistÃ³rico',
    component: HistoryPanel,  // Lista de operaÃ§Ãµes reversÃ­veis
  },
];
```

### Aba "Atributos" Detalhada

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ ğŸ“‹ ATRIBUTOS                    â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
â”‚ â”‚ Feature #42    [â—€ 3/5 â–¶]   â”‚ â”‚
â”‚ â”‚ Polygon â€¢ 24 vÃ©rtices      â”‚ â”‚
â”‚ â”‚ Ãrea: 1.234,56 mÂ²          â”‚ â”‚
â”‚ â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤ â”‚
â”‚ â”‚ inscricao   â”‚ 001.001.001  â”‚ â”‚
â”‚ â”‚ area        â”‚ 450.5        â”‚ â”‚
â”‚ â”‚ bairro      â”‚ Centro       â”‚ â”‚
â”‚ â”‚ proprietarioâ”‚ JoÃ£o Silva   â”‚ â”‚
â”‚ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
â”‚                                 â”‚
â”‚ [ğŸ” Zoom] [ğŸ“‹ Copiar] [ğŸ—‘ï¸ Del] â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ CAMADA: cadastro.lotes          â”‚
â”‚ â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
â”‚ â”‚  #  â”‚ inscricao  â”‚ area    â”‚ â”‚
â”‚ â”‚ â–º 1 â”‚ 001.001.001â”‚ 450.5   â”‚ â”‚
â”‚ â”‚   2 â”‚ 001.001.002â”‚ 380.0   â”‚ â”‚
â”‚ â”‚   3 â”‚ 001.002.001â”‚ 520.3   â”‚ â”‚
â”‚ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
â”‚ [Abrir tabela completa â†—]       â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### Aba "AnÃ¡lise" Detalhada

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ ğŸ“Š ANÃLISE                      â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ OPERAÃ‡Ã•ES ESPACIAIS             â”‚
â”‚ â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
â”‚ â”‚ â­• Buffer                    â”‚ â”‚
â”‚ â”‚ âœ‚ï¸ Cortar                   â”‚ â”‚
â”‚ â”‚ ğŸ”— Unir                     â”‚ â”‚
â”‚ â”‚ â– Subtrair                 â”‚ â”‚
â”‚ â”‚ âˆ©  InterseÃ§Ã£o               â”‚ â”‚
â”‚ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
â”‚                                 â”‚
â”‚ MEDIÃ‡ÃƒO                         â”‚
â”‚ â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
â”‚ â”‚ ğŸ“ DistÃ¢ncia                â”‚ â”‚
â”‚ â”‚ ğŸ“ Ãrea                     â”‚ â”‚
â”‚ â”‚ ğŸ“ Ã‚ngulo                   â”‚ â”‚
â”‚ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
â”‚                                 â”‚
â”‚ CONSULTAS                       â”‚
â”‚ â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
â”‚ â”‚ ğŸ” Por atributo             â”‚ â”‚
â”‚ â”‚ ğŸ“ Por localizaÃ§Ã£o          â”‚ â”‚
â”‚ â”‚ â¬œ Por retÃ¢ngulo            â”‚ â”‚
â”‚ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

### ComparaÃ§Ã£o Final

| Aspecto | PainÃ©is Flutuantes | Task Pane | HÃ­brido |
|---------|-------------------|-----------|---------|
| EspaÃ§o de mapa | â­â­â­ MÃ¡ximo | â­â­ Fixo | â­â­â­ ColapsÃ¡vel |
| Previsibilidade | â­â­ | â­â­â­ | â­â­â­ |
| Curva de aprendizado | â­â­ | â­â­â­ Familiar GIS | â­â­â­ |
| Workflows complexos | â­â­ | â­â­â­ | â­â­â­ |
| Mobile/Responsivo | â­â­â­ | â­ | â­â­ |
| ImplementaÃ§Ã£o | â­â­â­ Simples | â­â­ | â­â­ |

**RecomendaÃ§Ã£o:** O modelo **hÃ­brido** oferece o melhor dos dois mundos - Task Pane para navegaÃ§Ã£o/gerenciamento, painÃ©is flutuantes apenas para operaÃ§Ãµes em andamento.

---

## ReferÃªncias Visuais

### Autodesk Map 3D - Task Pane

O Task Pane agrupa recursos em "visualizaÃ§Ãµes relacionadas Ã  tarefas". As abas Display Manager, Map Explorer, Map Book e Survey organizam funcionalidades de forma previsÃ­vel. A Data Table abre a partir do Display Manager com sincronia bidirecional com o mapa.

### Blender - Popovers

O Blender usa popovers que aparecem diretamente abaixo do botÃ£o clicado, mantendo conexÃ£o visual clara com a ferramenta. O popover fecha ao clicar fora ou pressionar Escape.

### Figma - PainÃ©is Contextuais

O Figma mostra painÃ©is de propriedades que mudam dinamicamente baseado no elemento selecionado. Quando nada estÃ¡ selecionado, mostra opÃ§Ãµes do canvas.

### AutoCAD - Ribbon Compacto

O AutoCAD permite colapsar o ribbon para mostrar apenas os Ã­cones, economizando espaÃ§o vertical enquanto mantÃ©m acesso rÃ¡pido Ã s ferramentas.

---

## MÃ©tricas de Sucesso

1. **EspaÃ§o de Mapa**: > 85% da Ã¡rea da tela
2. **Cliques para AÃ§Ã£o**: â‰¤ 2 cliques para qualquer operaÃ§Ã£o comum
3. **Descobribilidade**: UsuÃ¡rio encontra ferramenta em < 5 segundos
4. **Contexto Claro**: UsuÃ¡rio sempre sabe que opÃ§Ãµes estÃ£o disponÃ­veis

---

*Documento criado em: Janeiro 2026*
*Ãšltima atualizaÃ§Ã£o: Janeiro 2026*
- Adicionado modelo hÃ­brido (Task Pane + PainÃ©is Flutuantes)
- IntegraÃ§Ã£o com react-resizable-panels para layout redimensionÃ¡vel
- IntegraÃ§Ã£o com headless-tree para Ã¡rvore hierÃ¡rquica de camadas
- Tabela de Atributos e Feature Inspector
- AnÃ¡lise comparativa: Task Pane vs PainÃ©is Flutuantes
